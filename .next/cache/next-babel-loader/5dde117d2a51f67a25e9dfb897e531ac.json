{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from \"react\";\nimport { Button, Form, Message } from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport record from \"../../ethereum/record\";\nimport web3 from \"../../ethereum/web3\";\n\nconst ipfsClient = require(\"ipfs-http-client\");\n\nconst ipfs = ipfsClient({\n  host: \"ipfs.infura.io\",\n  port: 5001,\n  protocol: \"https\"\n});\n\nclass addRecord extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      accounts: [],\n      reportBuffer: null,\n      prescriptionBuffer: null,\n      recordInstance: null,\n      loading: false,\n      message: \"\",\n      errorMessage: \"\",\n      visible: true\n    });\n\n    _defineProperty(this, \"captureReport\", event => {\n      event.preventDefault();\n      const file = event.target.files[0];\n      const reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onloadend = () => {\n        this.setState({\n          reportBuffer: Buffer(reader.result)\n        });\n        console.log(\"buffer\", this.state.reportBuffer);\n      };\n    });\n\n    _defineProperty(this, \"capturePrescription\", event => {\n      event.preventDefault();\n      const file = event.target.files[0];\n      const reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onloadend = () => {\n        this.setState({\n          prescriptionBuffer: Buffer(reader.result)\n        });\n        console.log(\"buffer\", this.state.prescriptionBuffer);\n      };\n    });\n\n    _defineProperty(this, \"onSubmit\", async event => {\n      event.preventDefault();\n      console.log(this.state.recordInstance.options.address);\n      this.setState({\n        loading: true,\n        message: \"Your files are being added to ipfs\",\n        errorMessage: \"\",\n        visible: false\n      });\n\n      try {\n        let resultPrescription = null;\n        let resultReport = null;\n        if (this.state.prescriptionBuffer != null) resultPrescription = await ipfs.add(this.state.prescriptionBuffer);\n        if (this.state.reportBuffer != null) resultReport = await ipfs.add(this.state.reportBuffer);\n        this.setState({\n          message: \"added your files pushing to blockchain\"\n        });\n\n        if (resultPrescription != null) {\n          const link = \"https://ipfs.infura.io/ipfs/\" + resultPrescription.path;\n          this.state.recordInstance.methods.setPrescriptionHash(this.state.accounts[0], link).send({\n            from: this.state.accounts[0]\n          });\n        }\n\n        if (resultReport != null) {\n          const link = \"https://ipfs.infura.io/ipfs/\" + resultReport.path;\n          this.state.recordInstance.methods.setreportHash(this.state.accounts[0], link).send({\n            from: this.state.accounts[0]\n          });\n        }\n      } catch (error) {\n        this.setState({\n          errorMessage: error.message\n        });\n      }\n\n      this.setState({\n        loading: false,\n        message: \"succefully done Thank you!!\"\n      });\n    });\n  }\n\n  static getInitialProps(props) {\n    const address = props.query.address;\n    console.log(address);\n    const docaddress = props.query.docaddress;\n    return {\n      address,\n      docaddress\n    };\n  }\n\n  async componentDidMount() {\n    const accounts = await web3.eth.getAccounts();\n    const recordInstance = record(this.props.address);\n    console.log(recordInstance.options.address);\n    this.setState({\n      accounts,\n      recordInstance\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxs(Layout, {\n      children: [/*#__PURE__*/_jsx(\"h3\", {\n        children: \"add files\"\n      }), /*#__PURE__*/_jsxs(Form, {\n        error: !!this.state.errorMessage,\n        onSubmit: this.onSubmit,\n        children: [/*#__PURE__*/_jsx(Form.Input, {\n          type: \"file\",\n          label: \"prescription(if any)\",\n          onChange: this.capturePrescription\n        }), /*#__PURE__*/_jsx(Form.Input, {\n          type: \"file\",\n          label: \"report(if any)\",\n          onChange: this.captureReport\n        }), /*#__PURE__*/_jsx(Button, {\n          primary: true,\n          loading: this.state.loading,\n          children: \"Submit\"\n        }), /*#__PURE__*/_jsx(Message, {\n          error: true,\n          header: \"Oops!!\",\n          content: this.state.errorMessage\n        }), /*#__PURE__*/_jsx(Message, {\n          info: true,\n          header: \":)\",\n          content: this.state.message,\n          hidden: this.state.visible\n        })]\n      })]\n    });\n  }\n\n}\n\nexport default addRecord;","map":{"version":3,"sources":["F:/Securing health records using blockchain/pages/Records/add.js"],"names":["React","Component","Button","Form","Message","Layout","record","web3","ipfsClient","require","ipfs","host","port","protocol","addRecord","accounts","reportBuffer","prescriptionBuffer","recordInstance","loading","message","errorMessage","visible","event","preventDefault","file","target","files","reader","window","FileReader","readAsArrayBuffer","onloadend","setState","Buffer","result","console","log","state","options","address","resultPrescription","resultReport","add","link","path","methods","setPrescriptionHash","send","from","setreportHash","error","getInitialProps","props","query","docaddress","componentDidMount","eth","getAccounts","render","onSubmit","capturePrescription","captureReport"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { Button, Form, Message } from \"semantic-ui-react\";\r\nimport Layout from \"../../components/Layout\";\r\nimport record from \"../../ethereum/record\";\r\nimport web3 from \"../../ethereum/web3\";\r\n\r\nconst ipfsClient = require(\"ipfs-http-client\");\r\n\r\nconst ipfs = ipfsClient({\r\n  host: \"ipfs.infura.io\",\r\n  port: 5001,\r\n  protocol: \"https\",\r\n});\r\n\r\nclass addRecord extends Component {\r\n  state = {\r\n    accounts: [],\r\n    reportBuffer: null,\r\n    prescriptionBuffer: null,\r\n    recordInstance: null,\r\n    loading: false,\r\n    message: \"\",\r\n    errorMessage: \"\",\r\n    visible: true,\r\n  };\r\n  static getInitialProps(props) {\r\n    const address = props.query.address;\r\n    console.log(address);\r\n    const docaddress = props.query.docaddress;\r\n    return { address, docaddress };\r\n  }\r\n  captureReport = (event) => {\r\n    event.preventDefault();\r\n    const file = event.target.files[0];\r\n    const reader = new window.FileReader();\r\n    reader.readAsArrayBuffer(file);\r\n    reader.onloadend = () => {\r\n      this.setState({ reportBuffer: Buffer(reader.result) });\r\n      console.log(\"buffer\", this.state.reportBuffer);\r\n    };\r\n  };\r\n  capturePrescription = (event) => {\r\n    event.preventDefault();\r\n    const file = event.target.files[0];\r\n    const reader = new window.FileReader();\r\n    reader.readAsArrayBuffer(file);\r\n    reader.onloadend = () => {\r\n      this.setState({ prescriptionBuffer: Buffer(reader.result) });\r\n      console.log(\"buffer\", this.state.prescriptionBuffer);\r\n    };\r\n  };\r\n  async componentDidMount() {\r\n    const accounts = await web3.eth.getAccounts();\r\n    const recordInstance = record(this.props.address);\r\n    console.log(recordInstance.options.address);\r\n    this.setState({ accounts, recordInstance });\r\n  }\r\n  onSubmit = async (event) => {\r\n    event.preventDefault();\r\n    console.log(this.state.recordInstance.options.address);\r\n    this.setState({\r\n      loading: true,\r\n      message: \"Your files are being added to ipfs\",\r\n      errorMessage: \"\",\r\n      visible: false,\r\n    });\r\n    try {\r\n      let resultPrescription = null;\r\n      let resultReport = null;\r\n      if (this.state.prescriptionBuffer != null)\r\n        resultPrescription = await ipfs.add(this.state.prescriptionBuffer);\r\n      if (this.state.reportBuffer != null)\r\n        resultReport = await ipfs.add(this.state.reportBuffer);\r\n      this.setState({ message: \"added your files pushing to blockchain\" });\r\n      if (resultPrescription != null) {\r\n        const link = \"https://ipfs.infura.io/ipfs/\" + resultPrescription.path;\r\n        this.state.recordInstance.methods\r\n          .setPrescriptionHash(this.state.accounts[0], link)\r\n          .send({ from: this.state.accounts[0] });\r\n      }\r\n      if (resultReport != null) {\r\n        const link = \"https://ipfs.infura.io/ipfs/\" + resultReport.path;\r\n        this.state.recordInstance.methods\r\n          .setreportHash(this.state.accounts[0], link)\r\n          .send({ from: this.state.accounts[0] });\r\n      }\r\n    } catch (error) {\r\n      this.setState({ errorMessage: error.message });\r\n    }\r\n    this.setState({ loading: false, message: \"succefully done Thank you!!\" });\r\n  };\r\n  render() {\r\n    return (\r\n      <Layout>\r\n        <h3>add files</h3>\r\n        <Form error={!!this.state.errorMessage} onSubmit={this.onSubmit}>\r\n          <Form.Input\r\n            type=\"file\"\r\n            label=\"prescription(if any)\"\r\n            onChange={this.capturePrescription}\r\n          />\r\n          <Form.Input\r\n            type=\"file\"\r\n            label=\"report(if any)\"\r\n            onChange={this.captureReport}\r\n          />\r\n          <Button primary loading={this.state.loading}>\r\n            Submit\r\n          </Button>\r\n          <Message error header=\"Oops!!\" content={this.state.errorMessage} />\r\n          <Message\r\n            info\r\n            header=\":)\"\r\n            content={this.state.message}\r\n            hidden={this.state.visible}\r\n          />\r\n        </Form>\r\n      </Layout>\r\n    );\r\n  }\r\n}\r\n\r\nexport default addRecord;\r\n"]},"metadata":{},"sourceType":"module"}